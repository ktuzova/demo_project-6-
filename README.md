# Онлайн-платформа для курсов и сбора данных активности студентов

## Описание

Платформа предназначена для онлайн-обучения с возможностью поиска курсов, преподавателей, материалов, сбора и аналитики активности студентов. Собранные данные готовы для дальнейшего анализа и построения рекомендательных систем.

---

## Основные возможности
- **Поиск курсов, материалов, преподавателей** по ключевым словам, категориям, уровням сложности и другим меткам
- **Регистрация, авторизация, роли** (student, teacher, admin)
- **Логирование активности** (просмотры, завершения, тесты и др.)
- **Аналитика** (прогресс, топ-материалы, средний балл)
- **ETL-выгрузка** для анализа и ML (в т.ч. в CSV)
- **Готовность к масштабированию** (асинхронность, поддержка PostgreSQL)

---

## Быстрый старт

1. **Установите зависимости**
   ```bash
   pip install -r requirements.txt
   ```
2. **Инициализируйте базу данных**
   ```bash
   python init_db.py
   ```
3. **Запустите сервер**
   ```bash
   python -m uvicorn main:app --reload
   ```
4. **(Опционально) Заполните тестовыми данными**
   ```bash
   python fill_test_data.py
   ```
5. **Откройте документацию API**
   [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)

---

## Основные эндпоинты

### Аутентификация и пользователи
- `POST /register` — регистрация пользователя
- `POST /token` — получение JWT-токена
- `GET /users` — список пользователей (admin/teacher)
- `PATCH /users/{user_id}` — редактирование пользователя (admin)
- `DELETE /users/{user_id}` — удаление пользователя (admin)

### Курсы и материалы
- `GET /courses` — список курсов
- `POST /courses` — создать курс (teacher/admin)
- `PATCH /courses/{course_id}` — редактировать курс (teacher/admin)
- `DELETE /courses/{course_id}` — удалить курс (teacher/admin)
- `GET /materials` — список материалов
- `POST /materials` — создать материал (teacher/admin)
- `PATCH /materials/{material_id}` — редактировать материал (teacher/admin)
- `DELETE /materials/{material_id}` — удалить материал (teacher/admin)

### Поиск
- `GET /search` — поиск курсов, материалов, преподавателей по фильтрам

### Логирование активности
- `POST /activity/log_event` — логирование действия пользователя (просмотр, завершение, тест и др.)

### Аналитика
- `GET /analytics/course/{course_id}/progress` — динамика прогресса по курсу
- `GET /analytics/course/{course_id}/top-materials` — топ-материалы по активности
- `GET /analytics/course/{course_id}/avg-test-score` — средний балл по тестам курса
- `GET /analytics/user/{user_id}/avg-test-score` — средний балл пользователя по тестам

### ETL и подготовка данных
- `GET /etl/export_full` — выгрузка истории активности (JSON)
- `GET /etl/export_csv` — выгрузка истории активности (CSV)
- `GET /recommendation/raw_data` — сырые данные для рекомендательных систем

---

## Пример логирования активности
```json
POST /activity/log_event
{
  "user_id": 2,
  "material_id": 1,
  "action": "view",
  "timestamp": "2024-06-01T12:00:00",
  "duration": 120.5
}
```

---

## Масштабирование и продакшн
- Для PostgreSQL замените строку подключения в `db.py` на:
  ```python
  DATABASE_URL = "postgresql+asyncpg://user:password@localhost/dbname"
  ```
- Для тяжелых ETL-операций используйте Celery или FastAPI BackgroundTasks.

---

## Контакты и поддержка
- Вопросы и предложения: [ваш email или github]

---

## Архитектура проекта

### Backend
- **FastAPI** — основной backend, реализует REST API, асинхронную обработку запросов, авторизацию (JWT), роли пользователей, аналитику, поиск, логирование активности, ETL-выгрузку.
- **SQLAlchemy (async)** — ORM для работы с базой данных (по умолчанию SQLite, легко заменить на PostgreSQL).
- **Модели**: User, Course, Material, Activity (лог событий).
- **ETL**: отдельные эндпоинты для выгрузки и агрегации данных для аналитики и рекомендаций.
- **CORS**: поддержка запросов с любого frontend.

### База данных
- **SQLite** (по умолчанию) — для разработки и тестирования.
- **PostgreSQL** — для продакшена (достаточно поменять строку подключения).
- **Структура**:
  - `users` — пользователи (студенты, преподаватели, админы)
  - `courses` — курсы
  - `materials` — материалы курса (видео, текст, тесты и др.)
  - `activities` — лог активности студентов (просмотры, завершения, тесты, время, баллы, meta)

### ETL и аналитика
- **ETL-эндпоинты**: выгрузка истории активности, агрегированных данных для ML/рекомендаций (JSON, CSV)
- **Аналитика**: прогресс, топ-материалы, средний балл, динамика активности, персональная аналитика по студенту и курсу

### Frontend
- **frontend.html** — простой HTML+JS интерфейс для тестирования платформы (авторизация, поиск, просмотр курсов/материалов, логирование активности)
- **Swagger UI** — автоматическая документация и тестирование API по адресу `/docs` 

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # или укажите адрес вашего фронтенда
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
) 